#!/usr/bin/env sh
# Lightweight pre-commit hook: fail fast on critical script removal or unsafe docs snippets
set -e
ROOT=$(git rev-parse --show-toplevel 2>/dev/null || echo .)
cd "$ROOT"

# Run critical checks (fast)
node scripts/ensure-critical-scripts.js || { echo "ERROR: critical scripts missing - aborting commit"; exit 1; }
node scripts/lint-md-powershell-staged.js || { echo "ERROR: PowerShell-unsafe snippets found in staged docs - fix before committing"; exit 1; }

# Run quick tests (fast integrity check)
npm run test:integrity --silent || { echo "ERROR: integrity tests failed - aborting commit"; exit 1; }

exit 0
