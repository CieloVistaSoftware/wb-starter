<div class="wb-hero" style="min-height: 40vh;">
  <div class="wb-hero__content" id="auto-pages-linkshtml-1">
    <h1>Interesting <span class="wb-gradient-text">Links</span></h1>
    <p class="wb-hero__subtitle">A curated list of interesting resources.</p>
  </div>
</div>

<section style="padding: 2rem;">
  <div style="max-width: 800px; margin: 0 auto;" id="auto-pages-linkshtml-2">
    
    <!-- Add Form -->
    <div class="wb-glass" style="padding: 2rem; margin-bottom: 2rem;" id="auto-pages-linkshtml-3">
      <h3 style="margin-top: 0;">Add New Link</h3>
      <form id="add-link-form" style="display: flex; flex-direction: column; gap: 1rem;">
        <input type="text" id="link-url" placeholder="URL (e.g. https://github.com/...)" class="wb-input-glass" required>
        <input type="text" id="link-title" placeholder="Title" class="wb-input-glass" required>
        <input type="text" id="link-desc" placeholder="Description" class="wb-input-glass">
        <button type="submit" class="wb-btn-gradient">Add Link</button>
      </form>
    </div>

    <!-- Links List -->
    <div id="links-list" style="display: flex; flex-direction: column; gap: 1rem;">
      <!-- Links will be injected here -->
    </div>

  </div>
</section>

<script>
  const DATA_FILE = 'data/interesting-links.json';
  let links = [];

  async function loadLinks() {
    try {
      const response = await fetch(DATA_FILE);
      if (response.ok) {
        links = await response.json();
        renderLinks();
      }
    } catch (error) {
      console.error('Error loading links:', error);
    }
  }

  async function saveLinks() {
    try {
      const response = await fetch('/api/save', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          location: DATA_FILE,
          data: links
        })
      });
      if (response.ok) {
        renderLinks();
      }
    } catch (error) {
      console.error('Error saving links:', error);
    }
  }

  function renderLinks() {
    const container = document.getElementById('links-list');
    container.innerHTML = '';
    
    links.forEach(link => {
      const item = document.createElement('div');
      item.className = 'wb-glass';
      item.style.padding = '1.5rem';
      item.style.display = 'flex';
      item.style.justifyContent = 'space-between';
      item.style.alignItems = 'center';
      item.style.gap = '1rem';
      
      item.innerHTML = `
        <div style="flex: 1;" id="auto-pages-linkshtml-4">
          <h3 style="margin: 0 0 0.5rem 0;">
            <a href="${link.url}" target="_blank" style="text-decoration: none; color: inherit;">${link.title}</a>
          </h3>
          <p style="margin: 0; font-size: 0.9rem; color: var(--text-secondary);">${link.description || ''}</p>
          <a href="${link.url}" target="_blank" style="font-size: 0.8rem; color: var(--primary); text-decoration: none; display: block; margin-top: 0.5rem;">${link.url}</a>
        </div>
        <div style="display: flex; gap: 0.5rem;" id="auto-pages-linkshtml-5">
          <button class="wb-btn-glass" onclick="editLink(${link.id})" style="padding: 0.5rem;" title="Edit">‚úèÔ∏è</button>
          <button class="wb-btn-glass" onclick="deleteLink(${link.id})" style="padding: 0.5rem; color: var(--danger-color, #ef4444);" title="Delete">üóëÔ∏è</button>
        </div>
      `;
      container.appendChild(item);
    });
  }

  document.getElementById('add-link-form').addEventListener('submit', (e) => {
    e.preventDefault();
    const url = document.getElementById('link-url').value;
    const title = document.getElementById('link-title').value;
    const desc = document.getElementById('link-desc').value;
    
    const newLink = {
      id: Date.now(),
      url,
      title,
      description: desc
    };
    
    links.unshift(newLink);
    saveLinks();
    e.target.reset();
  });

  window.deleteLink = (id) => {
    if(confirm('Are you sure you want to delete this link?')) {
      links = links.filter(l => l.id !== id);
      saveLinks();
    }
  };

  window.editLink = (id) => {
    const link = links.find(l => l.id === id);
    if (link) {
      const newTitle = prompt('Edit Title:', link.title);
      if (newTitle === null) return;
      
      const newDesc = prompt('Edit Description:', link.description);
      if (newDesc === null) return;
      
      const newUrl = prompt('Edit URL:', link.url);
      if (newUrl === null) return;

      link.title = newTitle;
      link.description = newDesc;
      link.url = newUrl;
      saveLinks();
    }
  };

  loadLinks();
</script>
