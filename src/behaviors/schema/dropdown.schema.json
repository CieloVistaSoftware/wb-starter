{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Dropdown",
  "description": "Toggleable dropdown menu",
  "behavior": "dropdown",
  "properties": {
    "position": {
      "type": "string",
      "enum": ["bottom-left", "bottom-right", "top-left", "top-right"],
      "default": "bottom-left"
    },
    "closeOnSelect": {
      "type": "boolean",
      "description": "Close menu when an item is selected",
      "default": true
    },
    "closeOnOutsideClick": {
      "type": "boolean",
      "description": "Close menu when clicking outside",
      "default": true
    }
  },
  "compliance": {
    "baseClass": "wb-dropdown",
    "requiredChildren": {
      ".wb-dropdown-trigger": {
        "description": "Button that toggles the menu",
        "tagName": "BUTTON"
      },
      ".wb-dropdown-menu": {
        "description": "Menu container with items",
        "tagName": "DIV"
      }
    }
  },
  "interactions": {
    "elements": {
      ".wb-dropdown-trigger": {
        "type": "trigger",
        "clickable": true,
        "click": {
          "action": "toggle menu",
          "event": "wb:dropdown:toggle"
        }
      },
      ".wb-dropdown-item": {
        "type": "menuitem",
        "clickable": true,
        "click": {
          "action": "select item",
          "event": "wb:dropdown:select"
        }
      }
    },
    "keyboard": {
      "Escape": {
        "target": ".wb-dropdown",
        "action": "close menu"
      },
      "ArrowDown": {
        "target": ".wb-dropdown-menu",
        "action": "focus next item"
      },
      "ArrowUp": {
        "target": ".wb-dropdown-menu",
        "action": "focus previous item"
      },
      "Enter": {
        "target": ".wb-dropdown-item",
        "action": "select item"
      },
      "Tab": {
        "target": ".wb-dropdown",
        "action": "close menu and move focus"
      }
    }
  },
  "accessibility": {
    "trigger": {
      "aria-haspopup": "menu",
      "aria-expanded": "dynamic"
    },
    "menu": {
      "role": "menu"
    },
    "item": {
      "role": "menuitem",
      "tabindex": "-1"
    }
  },
  "events": {
    "wb:dropdown:toggle": {
      "trigger": "Menu opens or closes",
      "detail": { "open": "boolean" },
      "bubbles": true
    },
    "wb:dropdown:open": {
      "trigger": "Menu opens",
      "detail": {},
      "bubbles": true
    },
    "wb:dropdown:close": {
      "trigger": "Menu closes",
      "detail": {},
      "bubbles": true
    },
    "wb:dropdown:select": {
      "trigger": "Item is selected",
      "detail": { "value": "string" },
      "bubbles": true
    }
  },
  "test": {
    "setup": [
      "<div data-wb=\"dropdown\"><button class=\"wb-dropdown-trigger\">Menu</button><div class=\"wb-dropdown-menu\"><button class=\"wb-dropdown-item\">Item 1</button><button class=\"wb-dropdown-item\">Item 2</button></div></div>"
    ],
    "matrix": {
      "combinations": [
        {},
        { "position": "bottom-left" },
        { "position": "bottom-right" },
        { "closeOnSelect": true },
        { "closeOnSelect": false }
      ]
    },
    "functional": {
      "buttons": [
        {
          "name": "trigger toggles menu",
          "setup": "<div data-wb=\"dropdown\"><button class=\"wb-dropdown-trigger\">Menu</button><div class=\"wb-dropdown-menu\"><button>Item</button></div></div>",
          "selector": ".wb-dropdown-trigger",
          "expect": { "selector": ".wb-dropdown-menu", "visible": true }
        }
      ],
      "interactions": [
        {
          "name": "clicking trigger opens menu",
          "setup": "<div data-wb=\"dropdown\"><button class=\"wb-dropdown-trigger\">Menu</button><div class=\"wb-dropdown-menu\"><button>Item</button></div></div>",
          "action": "click",
          "selector": ".wb-dropdown-trigger",
          "expect": { "selector": ".wb-dropdown-menu", "visible": true }
        },
        {
          "name": "clicking trigger again closes menu",
          "setup": "<div data-wb=\"dropdown\" class=\"open\"><button class=\"wb-dropdown-trigger\">Menu</button><div class=\"wb-dropdown-menu\" style=\"display:block\"><button>Item</button></div></div>",
          "action": "click",
          "selector": ".wb-dropdown-trigger",
          "expect": { "selector": ".wb-dropdown-menu", "visible": false }
        },
        {
          "name": "clicking outside closes menu",
          "setup": "<div data-wb=\"dropdown\" class=\"open\"><button class=\"wb-dropdown-trigger\">Menu</button><div class=\"wb-dropdown-menu\" style=\"display:block\"><button>Item</button></div></div><button id=\"outside\">Outside</button>",
          "action": "click",
          "selector": "#outside",
          "expect": { "selector": ".wb-dropdown-menu", "visible": false }
        },
        {
          "name": "dropdown fires toggle event",
          "setup": "<div data-wb=\"dropdown\"><button class=\"wb-dropdown-trigger\">Menu</button><div class=\"wb-dropdown-menu\"><button>Item</button></div></div>",
          "action": "click",
          "selector": ".wb-dropdown-trigger",
          "expect": { "event": "wb:dropdown:toggle" }
        }
      ],
      "keyboard": [
        {
          "name": "Escape closes menu",
          "setup": "<div data-wb=\"dropdown\" class=\"open\"><button class=\"wb-dropdown-trigger\">Menu</button><div class=\"wb-dropdown-menu\" style=\"display:block\"><button class=\"wb-dropdown-item\">Item 1</button></div></div>",
          "key": "Escape",
          "selector": ".wb-dropdown-trigger",
          "expect": { "selector": ".wb-dropdown-menu", "visible": false }
        },
        {
          "name": "ArrowDown moves focus to next item",
          "setup": "<div data-wb=\"dropdown\" class=\"open\"><button class=\"wb-dropdown-trigger\">Menu</button><div class=\"wb-dropdown-menu\" style=\"display:block\"><button class=\"wb-dropdown-item\">Item 1</button><button class=\"wb-dropdown-item\">Item 2</button></div></div>",
          "precondition": { "focused": ".wb-dropdown-item:first-child" },
          "key": "ArrowDown",
          "expect": { "focused": ".wb-dropdown-item:nth-child(2)" }
        },
        {
          "name": "ArrowUp moves focus to previous item",
          "setup": "<div data-wb=\"dropdown\" class=\"open\"><button class=\"wb-dropdown-trigger\">Menu</button><div class=\"wb-dropdown-menu\" style=\"display:block\"><button class=\"wb-dropdown-item\">Item 1</button><button class=\"wb-dropdown-item\">Item 2</button></div></div>",
          "precondition": { "focused": ".wb-dropdown-item:nth-child(2)" },
          "key": "ArrowUp",
          "expect": { "focused": ".wb-dropdown-item:first-child" }
        },
        {
          "name": "Enter selects focused item",
          "setup": "<div data-wb=\"dropdown\" class=\"open\"><button class=\"wb-dropdown-trigger\">Menu</button><div class=\"wb-dropdown-menu\" style=\"display:block\"><button class=\"wb-dropdown-item\">Item 1</button></div></div>",
          "precondition": { "focused": ".wb-dropdown-item" },
          "key": "Enter",
          "expect": { "event": "wb:dropdown:select" }
        }
      ],
      "dismiss": [
        {
          "name": "Escape dismisses dropdown",
          "setup": "<div data-wb=\"dropdown\" class=\"open\"><button class=\"wb-dropdown-trigger\">Menu</button><div class=\"wb-dropdown-menu\" style=\"display:block\"><button>Item</button></div></div>",
          "selector": ".wb-dropdown",
          "action": "press",
          "key": "Escape",
          "expect": { "selector": ".wb-dropdown", "notClass": "open" }
        },
        {
          "name": "outside click dismisses dropdown",
          "setup": "<div data-wb=\"dropdown\" class=\"open\"><button class=\"wb-dropdown-trigger\">Menu</button><div class=\"wb-dropdown-menu\" style=\"display:block\"><button>Item</button></div></div><button id=\"outside\">Outside</button>",
          "selector": "#outside",
          "action": "click",
          "expect": { "selector": ".wb-dropdown", "notClass": "open" }
        }
      ],
      "visual": [
        {
          "name": "dropdown has base class",
          "setup": "<div data-wb=\"dropdown\"><button class=\"wb-dropdown-trigger\">Menu</button><div class=\"wb-dropdown-menu\"><button>Item</button></div></div>",
          "expect": { "selector": "element", "hasClass": "wb-dropdown" }
        },
        {
          "name": "open dropdown has open class",
          "setup": "<div data-wb=\"dropdown\"><button class=\"wb-dropdown-trigger\">Menu</button><div class=\"wb-dropdown-menu\"><button>Item</button></div></div>",
          "action": "click",
          "selector": ".wb-dropdown-trigger",
          "expect": { "selector": "element", "hasClass": ["wb-dropdown", "open"] }
        },
        {
          "name": "menu is hidden when closed",
          "setup": "<div data-wb=\"dropdown\"><button class=\"wb-dropdown-trigger\">Menu</button><div class=\"wb-dropdown-menu\"><button>Item</button></div></div>",
          "expect": { "selector": ".wb-dropdown-menu", "visible": false }
        }
      ],
      "focus": [
        {
          "name": "focus moves to first item when opened",
          "setup": "<div data-wb=\"dropdown\"><button class=\"wb-dropdown-trigger\">Menu</button><div class=\"wb-dropdown-menu\"><button class=\"wb-dropdown-item\">Item 1</button></div></div>",
          "action": "click",
          "selector": ".wb-dropdown-trigger",
          "expect": { "focused": ".wb-dropdown-item:first-child" }
        }
      ]
    }
  }
}
