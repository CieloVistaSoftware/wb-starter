{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Card Video",
  "description": "Video card component. INHERITS from card.base (IS-A card), CONTAINS video (HAS-A figure with video element).",
  "behavior": "cardvideo",
  
  "$extends": "card.base.schema.json",
  "$inheritance": {
    "type": "IS-A",
    "parent": "card",
    "inherits": [
      "semantic.element",
      "semantic.structure.header",
      "semantic.structure.footer",
      "compliance.containerTag",
      "accessibility"
    ]
  },
  
  "$containment": [
    {
      "type": "HAS-A",
      "name": "video",
      "element": "FIGURE.wb-card__figure > VIDEO",
      "description": "Semantic figure containing video element"
    }
  ],
  
  "properties": {
    "$inherited": ["title", "subtitle", "footer", "hoverable", "elevated"],
    
    "src": {
      "type": "string",
      "description": "Video source URL",
      "required": true,
      "containedIn": "video",
      "permutations": {
        "type": "EXPLICIT",
        "values": [
          "https://www.w3schools.com/html/mov_bbb.mp4",
          "https://example.com/video.webm"
        ],
        "assertions": {
          "https://www.w3schools.com/html/mov_bbb.mp4": {
            "selector": "figure video",
            "checks": { "attribute": { "src": "https://www.w3schools.com/html/mov_bbb.mp4" } }
          }
        }
      }
    },
    "poster": {
      "type": "string",
      "description": "Poster image URL (shown before play)",
      "containedIn": "video",
      "permutations": {
        "type": "EXPLICIT",
        "values": ["https://picsum.photos/640/360", ""],
        "assertions": {
          "https://picsum.photos/640/360": {
            "selector": "figure video",
            "checks": { "attribute": { "poster": "https://picsum.photos/640/360" } }
          }
        }
      }
    },
    "autoplay": {
      "type": "boolean",
      "description": "Auto-play video (muted required)",
      "default": false,
      "inputType": "checkbox",
      "containedIn": "video",
      "permutations": {
        "type": "BOOLEAN",
        "assertions": {
          "true": {
            "selector": "figure video",
            "checks": { "attribute": { "autoplay": "" } }
          },
          "false": {
            "selector": "figure video",
            "checks": { "attributeAbsent": "autoplay" }
          }
        }
      }
    },
    "muted": {
      "type": "boolean",
      "description": "Mute video",
      "default": false,
      "inputType": "checkbox",
      "containedIn": "video",
      "permutations": {
        "type": "BOOLEAN",
        "assertions": {
          "true": {
            "selector": "figure video",
            "checks": { "attribute": { "muted": "" } }
          }
        }
      }
    },
    "loop": {
      "type": "boolean",
      "description": "Loop video playback",
      "default": false,
      "inputType": "checkbox",
      "containedIn": "video",
      "permutations": {
        "type": "BOOLEAN",
        "assertions": {
          "true": {
            "selector": "figure video",
            "checks": { "attribute": { "loop": "" } }
          }
        }
      }
    },
    "controls": {
      "type": "boolean",
      "description": "Show video controls",
      "default": true,
      "inputType": "checkbox",
      "containedIn": "video",
      "permutations": {
        "type": "BOOLEAN",
        "assertions": {
          "true": {
            "selector": "figure video",
            "checks": { "attribute": { "controls": "" } }
          },
          "false": {
            "selector": "figure video",
            "checks": { "attributeAbsent": "controls" }
          }
        }
      }
    },
    "aspect": {
      "type": "string",
      "description": "Video aspect ratio",
      "default": "16/9",
      "enum": ["16/9", "4/3", "1/1", "21/9"],
      "inputType": "select",
      "containedIn": "video",
      "permutations": {
        "type": "ENUM",
        "assertions": {
          "16/9": {
            "selector": "figure",
            "checks": { "style": { "aspectRatio": "16/9" } }
          },
          "4/3": {
            "selector": "figure",
            "checks": { "style": { "aspectRatio": "4/3" } }
          }
        }
      }
    },
    "title": {
      "type": "string",
      "description": "Card title",
      "mapsTo": "header",
      "permutations": {
        "type": "EXPLICIT",
        "values": ["Video Title", "My Video", ""],
        "assertions": {
          "Video Title": {
            "selector": "header h3.wb-card__title",
            "checks": { "exists": true, "textContains": "Video Title" }
          }
        }
      }
    }
  },
  
  "compliance": {
    "$inherits": "card.base.schema.json#compliance",
    "baseClass": "wb-card",
    "additionalClasses": ["wb-card--video"],
    "containerTag": {
      "preferred": "ARTICLE",
      "allowed": ["ARTICLE", "SECTION", "DIV"]
    },
    "requiredChildren": {
      "figure.wb-card__figure": {
        "description": "Semantic figure containing video",
        "tagName": "FIGURE",
        "required": true,
        "relationship": "HAS-A",
        "children": {
          "video": {
            "tagName": "VIDEO",
            "required": true
          }
        }
      }
    },
    "optionalChildren": {
      "header.wb-card__header": {
        "tagName": "HEADER",
        "createdWhen": "title is set"
      },
      "footer.wb-card__footer": {
        "tagName": "FOOTER",
        "createdWhen": "footer is set"
      }
    }
  },
  
  "interactions": {
    "elements": {
      "video": {
        "type": "video",
        "clickable": true,
        "click": {
          "action": "Toggle play/pause",
          "condition": "controls is false"
        }
      }
    }
  },
  
  "accessibility": {
    "$inherits": "card.base.schema.json#accessibility",
    "video": {
      "needsCaptions": "For accessibility, consider adding captions"
    }
  },
  
  "events": {
    "wb:cardvideo:play": {
      "source": "video",
      "bubbles": true,
      "firesWhen": "Video starts playing"
    },
    "wb:cardvideo:pause": {
      "source": "video",
      "bubbles": true,
      "firesWhen": "Video is paused"
    },
    "wb:cardvideo:ended": {
      "source": "video",
      "bubbles": true,
      "firesWhen": "Video playback ends"
    }
  },
  
  "test": {
    "setup": [
      "<article data-wb=\"cardvideo\" data-src=\"https://www.w3schools.com/html/mov_bbb.mp4\"></article>",
      "<article data-wb=\"cardvideo\" data-src=\"test.mp4\" data-title=\"My Video\" data-autoplay data-muted data-loop></article>"
    ],
    
    "matrix": {
      "description": "Test all property combinations",
      "combinations": [
        { "src": "test.mp4" },
        { "src": "test.mp4", "title": "Video" },
        { "src": "test.mp4", "poster": "poster.jpg" },
        { "src": "test.mp4", "autoplay": true, "muted": true },
        { "src": "test.mp4", "loop": true },
        { "src": "test.mp4", "controls": false },
        { "src": "test.mp4", "aspect": "4/3" },
        { "src": "test.mp4", "aspect": "1/1" },
        { "src": "test.mp4", "title": "Full", "poster": "p.jpg", "autoplay": true, "muted": true, "loop": true, "controls": true, "aspect": "16/9" }
      ]
    },
    
    "functional": {
      "semantic": [
        {
          "name": "Container should be ARTICLE (inherited)",
          "setup": "<article data-wb=\"cardvideo\" data-src=\"test.mp4\"></article>",
          "expect": { "selector": "element", "tagName": "ARTICLE" }
        },
        {
          "name": "Video should be in FIGURE (HAS-A video)",
          "setup": "<article data-wb=\"cardvideo\" data-src=\"test.mp4\"></article>",
          "expect": { "selector": "figure.wb-card__figure video", "tagName": "VIDEO" }
        },
        {
          "name": "Title creates HEADER (inherited)",
          "setup": "<article data-wb=\"cardvideo\" data-src=\"test.mp4\" data-title=\"Test\"></article>",
          "expect": { "selector": "header.wb-card__header h3.wb-card__title", "tagName": "H3" }
        }
      ],
      
      "rendering": [
        {
          "name": "Has wb-card--video class",
          "setup": "<article data-wb=\"cardvideo\" data-src=\"test.mp4\"></article>",
          "expect": { "selector": "element", "checks": { "hasClass": "wb-card--video" } }
        },
        {
          "name": "Video src attribute set",
          "setup": "<article data-wb=\"cardvideo\" data-src=\"test.mp4\"></article>",
          "expect": { "selector": "video", "checks": { "attribute": { "src": "test.mp4" } } }
        },
        {
          "name": "Poster attribute set",
          "setup": "<article data-wb=\"cardvideo\" data-src=\"test.mp4\" data-poster=\"poster.jpg\"></article>",
          "expect": { "selector": "video", "checks": { "attribute": { "poster": "poster.jpg" } } }
        },
        {
          "name": "Autoplay attribute set",
          "setup": "<article data-wb=\"cardvideo\" data-src=\"test.mp4\" data-autoplay></article>",
          "expect": { "selector": "video", "checks": { "attribute": { "autoplay": "" } } }
        },
        {
          "name": "Muted attribute set",
          "setup": "<article data-wb=\"cardvideo\" data-src=\"test.mp4\" data-muted></article>",
          "expect": { "selector": "video", "checks": { "attribute": { "muted": "" } } }
        },
        {
          "name": "Loop attribute set",
          "setup": "<article data-wb=\"cardvideo\" data-src=\"test.mp4\" data-loop></article>",
          "expect": { "selector": "video", "checks": { "attribute": { "loop": "" } } }
        },
        {
          "name": "Controls shown by default",
          "setup": "<article data-wb=\"cardvideo\" data-src=\"test.mp4\"></article>",
          "expect": { "selector": "video", "checks": { "attribute": { "controls": "" } } }
        },
        {
          "name": "Controls can be hidden",
          "setup": "<article data-wb=\"cardvideo\" data-src=\"test.mp4\" data-controls=\"false\"></article>",
          "expect": { "selector": "video", "checks": { "attributeAbsent": "controls" } }
        },
        {
          "name": "Aspect ratio applied to figure",
          "setup": "<article data-wb=\"cardvideo\" data-src=\"test.mp4\" data-aspect=\"4/3\"></article>",
          "expect": { "selector": "figure", "checks": { "style": { "aspectRatio": "4/3" } } }
        }
      ]
    }
  },
  
  "builder": {
    "category": "Cards",
    "icon": "ðŸŽ¬",
    "name": "Card Video",
    "description": "Card with embedded video",
    "defaults": {
      "src": "https://www.w3schools.com/html/mov_bbb.mp4",
      "title": "Video",
      "poster": "",
      "autoplay": false,
      "muted": false,
      "loop": false,
      "controls": true,
      "aspect": "16/9"
    },
    "propertyPanel": {
      "groups": [
        {
          "name": "Video",
          "properties": ["src", "poster", "aspect"]
        },
        {
          "name": "Playback",
          "properties": ["autoplay", "muted", "loop", "controls"]
        },
        {
          "name": "Card",
          "properties": ["title", "footer"]
        }
      ]
    }
  }
}
