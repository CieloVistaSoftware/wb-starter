{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Card Testimonial",
  "description": "Testimonial/review card. INHERITS from card.base (IS-A card), CONTAINS testimonial elements (HAS-A quote, attribution, avatar, rating).",
  "behavior": "cardtestimonial",
  
  "$extends": "card.base.schema.json",
  "$inheritance": {
    "type": "IS-A",
    "parent": "card",
    "inherits": [
      "semantic.element",
      "compliance.containerTag",
      "accessibility"
    ],
    "overrides": {
      "hoverable": false
    }
  },
  
  "$containment": [
    {
      "type": "HAS-A",
      "name": "quote",
      "element": "BLOCKQUOTE.wb-card__testimonial-quote",
      "description": "Semantic blockquote for the testimonial text"
    },
    {
      "type": "HAS-A",
      "name": "attribution",
      "element": "FOOTER > CITE",
      "description": "Semantic cite for author attribution"
    },
    {
      "type": "HAS-A",
      "name": "avatar",
      "element": "FOOTER FIGURE.wb-card__testimonial-avatar > IMG",
      "description": "Author avatar image"
    },
    {
      "type": "HAS-A",
      "name": "rating",
      "element": "P.wb-card__testimonial-rating",
      "description": "Star rating display"
    }
  ],
  
  "properties": {
    "$inherited": ["elevated"],
    
    "quote": {
      "type": "string",
      "description": "Testimonial quote text",
      "required": true,
      "containedIn": "quote",
      "default": "Great product!",
      "inputType": "textarea",
      "permutations": {
        "type": "EXPLICIT",
        "values": [
          "Great product!",
          "This has completely transformed our workflow. Highly recommended!",
          "Excellent service and support."
        ],
        "assertions": {
          "Great product!": {
            "selector": "blockquote.wb-card__testimonial-quote p",
            "checks": { "textContains": "Great product!" }
          }
        }
      }
    },
    "author": {
      "type": "string",
      "description": "Author name",
      "required": true,
      "containedIn": "attribution",
      "default": "John Doe",
      "permutations": {
        "type": "EXPLICIT",
        "values": ["John Doe", "Jane Smith", "Alex Johnson"],
        "assertions": {
          "John Doe": {
            "selector": "footer cite.wb-card__testimonial-author",
            "checks": { "textContains": "John Doe", "tagName": "CITE" }
          }
        }
      }
    },
    "role": {
      "type": "string",
      "description": "Author role/company",
      "containedIn": "attribution",
      "permutations": {
        "type": "EXPLICIT",
        "values": ["", "CEO", "CTO at Acme Corp", "Product Manager"],
        "assertions": {
          "CEO": {
            "selector": "footer span.wb-card__testimonial-role",
            "checks": { "textContains": "CEO" }
          }
        }
      }
    },
    "avatar": {
      "type": "string",
      "description": "Author avatar URL",
      "containedIn": "avatar",
      "permutations": {
        "type": "EXPLICIT",
        "values": ["", "https://i.pravatar.cc/60", "https://i.pravatar.cc/60?img=2"],
        "assertions": {
          "https://i.pravatar.cc/60": {
            "selector": "footer figure.wb-card__testimonial-avatar img",
            "checks": { "attribute": { "src": "https://i.pravatar.cc/60" } }
          },
          "": {
            "selector": "footer figure.wb-card__testimonial-avatar",
            "checks": { "exists": false }
          }
        }
      }
    },
    "rating": {
      "type": "number",
      "description": "Star rating (0-5)",
      "containedIn": "rating",
      "minimum": 0,
      "maximum": 5,
      "permutations": {
        "type": "EXPLICIT",
        "values": [0, 3, 4, 5],
        "assertions": {
          "5": {
            "selector": "p.wb-card__testimonial-rating",
            "checks": { "textContains": "â˜…â˜…â˜…â˜…â˜…" }
          },
          "3": {
            "selector": "p.wb-card__testimonial-rating",
            "checks": { "textContains": "â˜…â˜…â˜…" }
          },
          "0": {
            "selector": "p.wb-card__testimonial-rating",
            "checks": { "exists": false }
          }
        }
      }
    }
  },
  
  "compliance": {
    "$inherits": "card.base.schema.json#compliance",
    "baseClass": "wb-card",
    "additionalClasses": ["wb-card--testimonial"],
    "containerTag": {
      "preferred": "ARTICLE",
      "allowed": ["ARTICLE", "SECTION", "DIV"]
    },
    "requiredChildren": {
      "blockquote.wb-card__testimonial-quote": {
        "description": "Semantic blockquote for testimonial",
        "tagName": "BLOCKQUOTE",
        "required": true,
        "relationship": "HAS-A",
        "children": {
          "p": { "tagName": "P", "description": "Quote text" }
        }
      },
      "footer.wb-card__footer": {
        "description": "Footer with attribution",
        "tagName": "FOOTER",
        "required": true,
        "children": {
          "cite.wb-card__testimonial-author": {
            "tagName": "CITE",
            "required": true,
            "relationship": "HAS-A"
          }
        }
      }
    },
    "optionalChildren": {
      "figure.wb-card__testimonial-avatar": {
        "description": "Author avatar",
        "tagName": "FIGURE",
        "relationship": "HAS-A",
        "createdWhen": "avatar is set"
      },
      "p.wb-card__testimonial-rating": {
        "description": "Star rating",
        "tagName": "P",
        "relationship": "HAS-A",
        "createdWhen": "rating > 0"
      }
    }
  },
  
  "accessibility": {
    "$inherits": "card.base.schema.json#accessibility",
    "avatar": {
      "alt": "Photo of {author}"
    },
    "rating": {
      "ariaLabel": "{rating} out of 5 stars"
    }
  },
  
  "test": {
    "setup": [
      "<article data-wb=\"cardtestimonial\" data-quote=\"Great!\" data-author=\"John\"></article>",
      "<article data-wb=\"cardtestimonial\" data-quote=\"Amazing!\" data-author=\"Jane\" data-role=\"CEO\" data-avatar=\"https://i.pravatar.cc/60\" data-rating=\"5\"></article>"
    ],
    
    "matrix": {
      "description": "Test all property combinations",
      "combinations": [
        { "quote": "Great!", "author": "John" },
        { "quote": "Great!", "author": "John", "role": "CEO" },
        { "quote": "Great!", "author": "John", "avatar": "https://i.pravatar.cc/60" },
        { "quote": "Great!", "author": "John", "rating": 5 },
        { "quote": "Great!", "author": "John", "rating": 3 },
        { "quote": "Great!", "author": "John", "rating": 0 },
        { "quote": "Longer testimonial text here.", "author": "Jane", "role": "CTO", "avatar": "https://i.pravatar.cc/60", "rating": 4 },
        { "quote": "Full testimonial", "author": "Alex", "role": "Manager at Corp", "avatar": "img.jpg", "rating": 5, "elevated": true }
      ]
    },
    
    "functional": {
      "semantic": [
        {
          "name": "Container should be ARTICLE (inherited)",
          "setup": "<article data-wb=\"cardtestimonial\" data-quote=\"Test\" data-author=\"John\"></article>",
          "expect": { "selector": "element", "tagName": "ARTICLE" }
        },
        {
          "name": "Quote should be in BLOCKQUOTE (HAS-A quote)",
          "setup": "<article data-wb=\"cardtestimonial\" data-quote=\"Test\" data-author=\"John\"></article>",
          "expect": { "selector": "blockquote.wb-card__testimonial-quote", "tagName": "BLOCKQUOTE" }
        },
        {
          "name": "Quote text should be in P",
          "setup": "<article data-wb=\"cardtestimonial\" data-quote=\"Test\" data-author=\"John\"></article>",
          "expect": { "selector": "blockquote p", "tagName": "P" }
        },
        {
          "name": "Author should be in CITE (HAS-A attribution)",
          "setup": "<article data-wb=\"cardtestimonial\" data-quote=\"Test\" data-author=\"John\"></article>",
          "expect": { "selector": "footer cite.wb-card__testimonial-author", "tagName": "CITE" }
        },
        {
          "name": "Avatar should be in FIGURE (HAS-A avatar)",
          "setup": "<article data-wb=\"cardtestimonial\" data-quote=\"Test\" data-author=\"John\" data-avatar=\"img.jpg\"></article>",
          "expect": { "selector": "footer figure.wb-card__testimonial-avatar img", "tagName": "IMG" }
        },
        {
          "name": "Footer uses semantic FOOTER",
          "setup": "<article data-wb=\"cardtestimonial\" data-quote=\"Test\" data-author=\"John\"></article>",
          "expect": { "selector": "footer.wb-card__footer", "tagName": "FOOTER" }
        }
      ],
      
      "rendering": [
        {
          "name": "Has wb-card--testimonial class",
          "setup": "<article data-wb=\"cardtestimonial\" data-quote=\"Test\" data-author=\"John\"></article>",
          "expect": { "selector": "element", "checks": { "hasClass": "wb-card--testimonial" } }
        },
        {
          "name": "Quote text rendered",
          "setup": "<article data-wb=\"cardtestimonial\" data-quote=\"Great product!\" data-author=\"John\"></article>",
          "expect": { "selector": "blockquote p", "checks": { "textContains": "Great product!" } }
        },
        {
          "name": "Author text rendered",
          "setup": "<article data-wb=\"cardtestimonial\" data-quote=\"Test\" data-author=\"Jane Doe\"></article>",
          "expect": { "selector": "cite.wb-card__testimonial-author", "checks": { "textContains": "Jane Doe" } }
        },
        {
          "name": "Role rendered when set",
          "setup": "<article data-wb=\"cardtestimonial\" data-quote=\"Test\" data-author=\"John\" data-role=\"CEO\"></article>",
          "expect": { "selector": "span.wb-card__testimonial-role", "checks": { "textContains": "CEO" } }
        },
        {
          "name": "Avatar src set",
          "setup": "<article data-wb=\"cardtestimonial\" data-quote=\"Test\" data-author=\"John\" data-avatar=\"avatar.jpg\"></article>",
          "expect": { "selector": "figure.wb-card__testimonial-avatar img", "checks": { "attribute": { "src": "avatar.jpg" } } }
        },
        {
          "name": "Avatar hidden when not set",
          "setup": "<article data-wb=\"cardtestimonial\" data-quote=\"Test\" data-author=\"John\"></article>",
          "expect": { "selector": "figure.wb-card__testimonial-avatar", "checks": { "exists": false } }
        },
        {
          "name": "5 stars rendered",
          "setup": "<article data-wb=\"cardtestimonial\" data-quote=\"Test\" data-author=\"John\" data-rating=\"5\"></article>",
          "expect": { "selector": "p.wb-card__testimonial-rating", "checks": { "textContains": "â˜…â˜…â˜…â˜…â˜…" } }
        },
        {
          "name": "3 stars rendered",
          "setup": "<article data-wb=\"cardtestimonial\" data-quote=\"Test\" data-author=\"John\" data-rating=\"3\"></article>",
          "expect": { "selector": "p.wb-card__testimonial-rating", "checks": { "textContains": "â˜…â˜…â˜…" } }
        },
        {
          "name": "Rating hidden when 0",
          "setup": "<article data-wb=\"cardtestimonial\" data-quote=\"Test\" data-author=\"John\" data-rating=\"0\"></article>",
          "expect": { "selector": "p.wb-card__testimonial-rating", "checks": { "exists": false } }
        }
      ],
      
      "accessibility": [
        {
          "name": "Avatar has alt with author name",
          "setup": "<article data-wb=\"cardtestimonial\" data-quote=\"Test\" data-author=\"John Doe\" data-avatar=\"img.jpg\"></article>",
          "expect": { 
            "selector": "figure.wb-card__testimonial-avatar img", 
            "checks": { "attribute": { "alt": "Photo of John Doe" } }
          }
        },
        {
          "name": "Rating has aria-label",
          "setup": "<article data-wb=\"cardtestimonial\" data-quote=\"Test\" data-author=\"John\" data-rating=\"4\"></article>",
          "expect": { 
            "selector": "p.wb-card__testimonial-rating", 
            "checks": { "attribute": { "aria-label": "4 out of 5 stars" } }
          }
        }
      ]
    }
  },
  
  "builder": {
    "category": "Cards",
    "icon": "ðŸ’¬",
    "name": "Card Testimonial",
    "description": "Customer testimonial/review card",
    "defaults": {
      "quote": "Great product! Highly recommended.",
      "author": "John Doe",
      "role": "CEO",
      "avatar": "",
      "rating": 5
    },
    "propertyPanel": {
      "groups": [
        {
          "name": "Testimonial",
          "properties": ["quote", "rating"]
        },
        {
          "name": "Author",
          "properties": ["author", "role", "avatar"]
        },
        {
          "name": "Style",
          "properties": ["elevated"]
        }
      ]
    }
  }
}
