<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MVVM Schema Builder Test v3</title>
  <link rel="stylesheet" href="../styles/themes.css">
  <link rel="stylesheet" href="../styles/site.css">
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      padding: 2rem;
      max-width: 1200px;
      margin: 0 auto;
      background: var(--bg-color);
      color: var(--text-primary);
    }
    
    h1 { color: var(--primary); margin-bottom: 0.5rem; }
    h2 { color: var(--text-secondary); margin-top: 2rem; border-bottom: 1px solid var(--border-color); padding-bottom: 0.5rem; }
    
    .test-section {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
      margin: 1rem 0;
    }
    
    .test-box {
      padding: 1.5rem;
      background: var(--bg-secondary);
      border-radius: 8px;
      border: 1px solid var(--border-color);
    }
    
    .test-box h3 {
      margin-top: 0;
      color: var(--text-secondary);
      font-size: 0.875rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    
    pre {
      background: var(--bg-tertiary);
      padding: 1rem;
      border-radius: 4px;
      overflow-x: auto;
      font-size: 0.75rem;
      white-space: pre-wrap;
    }
    
    code {
      color: var(--primary);
    }
    
    .status {
      padding: 0.5rem 1rem;
      border-radius: 4px;
      margin: 1rem 0;
    }
    .status.success { background: rgba(34, 197, 94, 0.2); color: #22c55e; }
    .status.error { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
    .status.info { background: rgba(59, 130, 246, 0.2); color: #3b82f6; }
    
    .mvvm-table {
      width: 100%;
      border-collapse: collapse;
      margin: 1rem 0;
    }
    .mvvm-table th, .mvvm-table td {
      padding: 0.75rem;
      border: 1px solid var(--border-color);
      text-align: left;
    }
    .mvvm-table th {
      background: var(--bg-tertiary);
      font-weight: 600;
    }
    .mvvm-table code {
      font-size: 0.85em;
    }
    
    /* ===========================================
       AUTO-GENERATED CLASSES FROM SCHEMA
       baseClass: wb-card
       Parts: header, title, subtitle, main, footer
       Classes: wb-card__header, wb-card__title, etc.
       =========================================== */
    
    wb-card, .wb-card {
      display: block;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      overflow: hidden;
    }
    .wb-card--elevated {
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    .wb-card--glass {
      background: rgba(255,255,255,0.1);
      backdrop-filter: blur(10px);
    }
    
    .wb-card__header {
      padding: 1rem;
      border-bottom: 1px solid var(--border-color);
      background: var(--bg-tertiary);
    }
    .wb-card__title { 
      margin: 0; 
      font-size: 1.125rem; 
    }
    .wb-card__subtitle { 
      margin: 0.25rem 0 0; 
      color: var(--text-secondary); 
      font-size: 0.875rem; 
    }
    .wb-card__main { 
      padding: 1rem; 
    }
    .wb-card__footer { 
      padding: 1rem; 
      border-top: 1px solid var(--border-color); 
      background: var(--bg-tertiary); 
    }
    
    /* Badge - CSS only, no schema needed */
    wb-badge {
      display: inline-flex;
      padding: 0.25em 0.5em;
      border-radius: 4px;
      font-size: 0.875rem;
      font-weight: 500;
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }
    wb-badge[variant="success"] { background: var(--success); color: white; }
    wb-badge[variant="warning"] { background: var(--warning); color: black; }
    wb-badge[variant="error"] { background: var(--error); color: white; }
    
    .schema-format {
      background: var(--bg-tertiary);
      padding: 1rem;
      border-radius: 8px;
      margin: 1rem 0;
      font-family: monospace;
      font-size: 0.8rem;
    }
  </style>
</head>
<body>
  <h1>üèóÔ∏è MVVM Schema Builder v3.0</h1>
  <p><code>$view</code> + <code>$methods</code> format with lowercase HTML5 tags.</p>
  
  <div id="status" class="status info">Loading schemas...</div>

  <!-- ============================================ -->
  <h2>MVVM Structure</h2>
  <!-- ============================================ -->
  <table class="mvvm-table">
    <thead>
      <tr>
        <th>Layer</th>
        <th>Schema Section</th>
        <th>Purpose</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><strong>M</strong>odel</td>
        <td><code>properties</code></td>
        <td>Data inputs (attributes)</td>
      </tr>
      <tr>
        <td><strong>V</strong>iew</td>
        <td><code>$view</code></td>
        <td>DOM structure (lowercase tags)</td>
      </tr>
      <tr>
        <td><strong>V</strong>iew<strong>M</strong>odel</td>
        <td><code>$methods</code></td>
        <td>Callable functions</td>
      </tr>
    </tbody>
  </table>

  <!-- ============================================ -->
  <h2>Schema Format (v3.0)</h2>
  <!-- ============================================ -->
  <div class="schema-format">
<pre>{
  "behavior": "card",
  "baseClass": "wb-card",
  
  "properties": {
    "title":   { "type": "string" },
    "elevated": { "type": "boolean" }
  },
  
  "$view": [
    { "name": "header", "tag": "header", "createdWhen": "title OR subtitle" },
    { "name": "title",  "tag": "h3", "parent": "header", "content": "{{title}}" },
    { "name": "main",   "tag": "main", "required": true, "content": "{{slot}}" },
    { "name": "footer", "tag": "footer", "createdWhen": "footer" }
  ],
  
  "$methods": {
    "show":   { "description": "Shows the card" },
    "hide":   { "description": "Hides the card" },
    "toggle": { "description": "Toggles visibility" }
  }
}

Classes AUTO-GENERATED: baseClass + "__" + name
  ‚Üí wb-card__header
  ‚Üí wb-card__title
  ‚Üí wb-card__main
  ‚Üí wb-card__footer</pre>
  </div>
  
  <!-- ============================================ -->
  <h2>1. Badge (CSS-only, no JS needed)</h2>
  <!-- ============================================ -->
  <div class="test-section">
    <div class="test-box">
      <h3>Web Component Tags</h3>
      <p>
        <wb-badge>Default</wb-badge>
        <wb-badge variant="success">Success</wb-badge>
        <wb-badge variant="warning">Warning</wb-badge>
        <wb-badge variant="error">Error</wb-badge>
      </p>
      <p style="color: var(--text-tertiary); font-size: 0.8rem; margin-top: 1rem;">
        CSS styles <code>wb-badge</code> tag directly. No JavaScript, no schema processing.
      </p>
    </div>
    <div class="test-box">
      <h3>HTML Output</h3>
      <pre>&lt;wb-badge variant="success"&gt;Success&lt;/wb-badge&gt;

CSS:
wb-badge[variant="success"] { 
  background: var(--success); 
}</pre>
    </div>
  </div>
  
  <!-- ============================================ -->
  <h2>2. Card with Title (Schema-built)</h2>
  <!-- ============================================ -->
  <div class="test-section">
    <div class="test-box">
      <h3>&lt;wb-card&gt; Tag</h3>
      <wb-card title="Hello World">
        <p>This content goes in the main slot.</p>
      </wb-card>
    </div>
    <div class="test-box">
      <h3>data-wb Attribute</h3>
      <wb-card data-title="Hello World"
        <p>This content goes in the main slot.</p>
      </article>
    </div>
  </div>
  
  <!-- ============================================ -->
  <h2>3. Card with Title + Subtitle</h2>
  <!-- ============================================ -->
  <div class="test-section">
    <div class="test-box">
      <h3>&lt;wb-card&gt; Tag</h3>
      <wb-card title="Card Title" subtitle="A helpful subtitle">
        <p>Content with both title and subtitle.</p>
      </wb-card>
    </div>
    <div class="test-box">
      <h3>Generated DOM</h3>
      <pre id="dom-output-2">Loading...</pre>
    </div>
  </div>
  
  <!-- ============================================ -->
  <h2>4. Card with Footer</h2>
  <!-- ============================================ -->
  <div class="test-section">
    <div class="test-box">
      <h3>&lt;wb-card&gt; Tag</h3>
      <wb-card title="With Footer" footer="Footer text here">
        <p>This card has a footer section.</p>
      </wb-card>
    </div>
    <div class="test-box">
      <h3>data-wb Attribute</h3>
      <wb-card data-title="With Footer" data-footer="Footer text here"
        <p>This card has a footer section.</p>
      </article>
    </div>
  </div>
  
  <!-- ============================================ -->
  <h2>5. Full Card (Title + Subtitle + Footer + Elevated)</h2>
  <!-- ============================================ -->
  <div class="test-section">
    <div class="test-box">
      <h3>&lt;wb-card&gt; Tag</h3>
      <wb-card title="Full Example" subtitle="All the parts" footer="¬© 2025" elevated>
        <p>This card demonstrates all $view parts being created.</p>
      </wb-card>
    </div>
    <div class="test-box">
      <h3>Generated DOM</h3>
      <pre id="dom-output-5">Loading...</pre>
    </div>
  </div>
  
  <!-- ============================================ -->
  <h2>6. Minimal Card (No Header)</h2>
  <!-- ============================================ -->
  <div class="test-section">
    <div class="test-box">
      <h3>&lt;wb-card&gt; Tag</h3>
      <wb-card>
        <p>Just content, no title means no header created.</p>
      </wb-card>
    </div>
    <div class="test-box">
      <h3>Generated DOM</h3>
      <pre id="dom-output-6">Loading...</pre>
    </div>
  </div>
  
  <!-- ============================================ -->
  <h2>7. $methods Test</h2>
  <!-- ============================================ -->
  <div class="test-section">
    <div class="test-box">
      <h3>Method Binding</h3>
      <wb-card id="method-test" title="Method Test">
        <p>Click buttons to test $methods.</p>
        <p>
          <button onclick="document.getElementById('method-test').hide?.() || alert('hide() not implemented yet')">Hide</button>
          <button onclick="document.getElementById('method-test').show?.() || alert('show() not implemented yet')">Show</button>
          <button onclick="document.getElementById('method-test').toggle?.() || alert('toggle() not implemented yet')">Toggle</button>
        </p>
      </wb-card>
    </div>
    <div class="test-box">
      <h3>$methods Definition</h3>
      <pre>"$methods": {
  "show":   { "description": "Shows the card" },
  "hide":   { "description": "Hides the card" },
  "toggle": { "description": "Toggles visibility" }
}

// Usage:
element.show()
element.hide()
element.toggle()</pre>
    </div>
  </div>

  <!-- ============================================ -->
  <h2>Debug Info</h2>
  <!-- ============================================ -->
  <div id="debug">
    <pre id="schema-list">Loading schemas...</pre>
  </div>

  <script type="module">
    import SchemaBuilder from './mvvm/index.js';
    
    const status = document.getElementById('status');
    const schemaList = document.getElementById('schema-list');
    
    function escapeHtml(html) {
      return html
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;');
    }
    
    function formatDom(el) {
      // Simple DOM formatter
      const clone = el.cloneNode(true);
      return clone.outerHTML
        .replace(/></g, '>\n<')
        .replace(/(<[^>]+>)/g, (m) => {
          if (m.startsWith('</')) return '\n' + m;
          return m;
        })
        .split('\n')
        .map((line, i) => {
          const indent = line.match(/^<\//) ? '' : '  '.repeat(Math.min(i, 3));
          return indent + line.trim();
        })
        .filter(l => l.trim())
        .join('\n');
    }
    
    try {
      await SchemaBuilder.init({ schemaPath: '/src/wb-models' });
      
      const schemas = [...SchemaBuilder.registry.keys()];
      schemaList.textContent = `Loaded ${schemas.length} schemas:\n` + 
        schemas.map(s => `  ‚úì ${s}`).join('\n');
      
      status.className = 'status success';
      status.textContent = `‚úì Schema Builder v3.0 ready! ${schemas.length} schemas loaded.`;
      
      // Show generated DOM for examples
      setTimeout(() => {
        const card2 = document.querySelectorAll('wb-card')[1];
        const card5 = document.querySelectorAll('wb-card')[3];
        const card6 = document.querySelectorAll('wb-card')[4];
        
        if (card2) document.getElementById('dom-output-2').textContent = formatDom(card2);
        if (card5) document.getElementById('dom-output-5').textContent = formatDom(card5);
        if (card6) document.getElementById('dom-output-6').textContent = formatDom(card6);
      }, 100);
      
    } catch (error) {
      status.className = 'status error';
      status.textContent = `‚úó Error: ${error.message}`;
      schemaList.textContent = error.stack;
      console.error(error);
    }
  </script>
</body>
</html>
