{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "page.schema.json",
  "title": "WB Page & Demo Schema",
  "description": "Defines the structural contracts for pages, demos, and page-schema JSON files in WB-Starter. Three tiers: pages (server-wrapped fragments), demos (standalone full documents), and page-schemas (JSON definitions for generated pages).",
  "schemaType": "definition",

  "$defs": {

    "pageFragment": {
      "title": "Page Fragment Contract",
      "description": "HTML files in pages/ that the server wraps with the site shell. These are NOT full documents.",
      "type": "object",
      "properties": {
        "location": {
          "const": "pages/",
          "description": "Page fragments live in the pages/ directory"
        },
        "rules": {
          "type": "object",
          "description": "Structural rules every page fragment must follow",
          "properties": {
            "prohibited": {
              "type": "array",
              "description": "Elements that MUST NOT appear in page fragments",
              "items": { "type": "string" },
              "default": [
                "<!DOCTYPE>",
                "<html>",
                "<head>",
                "<body>",
                "<style> blocks (use page CSS file or behavior CSS)",
                "<link> to site.css or themes.css (server injects these)",
                "<script type='module'> with WB.init() (server handles it)",
                "Extensive inline styles (more than basic layout tweaks)"
              ]
            },
            "requiredZones": {
              "type": "array",
              "description": "Layout zones every page SHOULD have, in order",
              "items": {
                "type": "object",
                "properties": {
                  "class": { "type": "string" },
                  "required": { "type": "boolean" },
                  "contains": { "type": "string" },
                  "description": { "type": "string" }
                }
              },
              "default": [
                {
                  "class": "page__hero",
                  "required": true,
                  "contains": "h1 + p",
                  "description": "Page title banner. Must contain an h1 and a subtitle p."
                },
                {
                  "class": "page__section",
                  "required": true,
                  "contains": "h2 + content",
                  "description": "Repeatable content section. Each section starts with h2. Content can use .page__grid or any wb-* components."
                }
              ]
            },
            "allowedCSS": {
              "type": "object",
              "description": "How page-specific styles are loaded",
              "properties": {
                "pageCSS": {
                  "type": "string",
                  "description": "Optional page-specific CSS via <link rel='stylesheet' href='../src/styles/pages/{name}.css'>"
                },
                "neverInline": {
                  "type": "boolean",
                  "const": true,
                  "description": "Never use inline styles for component styling. Minor layout tweaks (display:flex on a wrapper) are tolerated but discouraged."
                },
                "neverStyleBlock": {
                  "type": "boolean",
                  "const": true,
                  "description": "Never put <style> blocks in page fragments."
                }
              }
            },
            "layoutClasses": {
              "type": "object",
              "description": "Available layout classes from site.css. Use these instead of inline styles.",
              "properties": {
                "page__hero": { "type": "string", "default": "Top banner with title + subtitle + optional CTA" },
                "page__section": { "type": "string", "default": "Content section with vertical spacing" },
                "page__grid": { "type": "string", "default": "Auto-fit responsive grid for cards, stats, etc." },
                "page__loading": { "type": "string", "default": "Loading state overlay" },
                "page--404": { "type": "string", "default": "Not found state" }
              }
            }
          }
        }
      }
    },

    "demo": {
      "$comment": "Demo file contract has been moved to demofile.schema.json as the single source of truth. See that file for all rules governing demos/*.html files.",
      "$ref": "demofile.schema.json"
    },

    "pageSchemaJSON": {
      "title": "Page Schema JSON",
      "description": "JSON files in src/wb-models/pages/ that define page structure for auto-generation.",
      "type": "object",
      "required": ["title", "description", "sections"],
      "properties": {
        "title": {
          "type": "string",
          "minLength": 1,
          "description": "Page title"
        },
        "description": {
          "type": "string",
          "minLength": 1,
          "description": "What this page shows"
        },
        "schemaFor": {
          "type": "string",
          "description": "Page identifier in kebab-case"
        },
        "page": {
          "type": "object",
          "description": "Shell configuration (lang, theme, stylesheets, scripts)",
          "properties": {
            "lang": { "type": "string", "default": "en" },
            "theme": { "type": "string", "default": "dark" },
            "title": { "type": "string" },
            "stylesheets": {
              "type": "array",
              "items": { "type": "string" }
            },
            "scripts": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "type": { "type": "string" },
                  "src": { "type": "string" },
                  "init": { "type": "string" }
                }
              }
            }
          }
        },
        "header": {
          "type": "object",
          "description": "Page header configuration",
          "properties": {
            "tag": { "type": "string" },
            "content": { "type": "string" },
            "subtitle": {
              "type": "object",
              "properties": {
                "tag": { "type": "string" },
                "content": { "type": "string" }
              }
            }
          }
        },
        "sections": {
          "type": "array",
          "minItems": 1,
          "description": "Page content sections with demos",
          "items": {
            "$ref": "#/$defs/pageSection"
          }
        },
        "_metadata": {
          "type": "object",
          "description": "Generation and tracking metadata",
          "properties": {
            "category": { "type": "string" },
            "icon": { "type": "string" },
            "sourceSchema": { "type": "string" },
            "generatedAt": { "type": "string" },
            "sectionCount": { "type": "integer" },
            "totalDemos": { "type": "integer" }
          }
        },
        "_composed": {
          "type": "object",
          "description": "Composition tracking (resolved extends, refs, includes)"
        }
      }
    },

    "pageSection": {
      "type": "object",
      "required": ["heading", "demos"],
      "properties": {
        "heading": {
          "type": "string",
          "minLength": 1,
          "description": "Section heading text"
        },
        "tag": {
          "type": "string",
          "description": "Primary wb-* component tag for this section"
        },
        "columns": {
          "type": "integer",
          "minimum": 1,
          "maximum": 6,
          "default": 3,
          "description": "Grid columns for demo layout"
        },
        "demos": {
          "type": "array",
          "minItems": 1,
          "description": "Component demo instances",
          "items": {
            "$ref": "#/$defs/demoItem"
          }
        }
      }
    },

    "demoItem": {
      "type": "object",
      "required": ["tag", "attrs"],
      "properties": {
        "tag": {
          "type": "string",
          "description": "HTML tag for this demo instance (e.g. wb-badge, wb-progress)"
        },
        "attrs": {
          "type": "object",
          "description": "Attributes to set on the component"
        },
        "content": {
          "type": "string",
          "description": "Optional inner HTML content"
        }
      }
    },

    "siteSchema": {
      "title": "Site Schema",
      "description": "Multi-page site definitions (*.site.json) that group pages into a collection.",
      "type": "object",
      "required": ["title", "pages"],
      "properties": {
        "title": { "type": "string" },
        "description": { "type": "string" },
        "outputDir": { "type": "string" },
        "generateIndex": { "type": "boolean" },
        "pages": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "required": ["id", "title", "components"],
            "properties": {
              "id": { "type": "string" },
              "title": { "type": "string" },
              "description": { "type": "string" },
              "icon": { "type": "string" },
              "components": {
                "type": "array",
                "items": { "type": "string" }
              }
            }
          }
        }
      }
    }
  },

  "description_summary": "This schema documents three content tiers:\n\n1. PAGE FRAGMENTS (pages/*.html) — Server-wrapped, follow layout contract, no shell\n2. DEMOS (demos/*.html) — Standalone full documents, self-contained, own their shell\n3. PAGE SCHEMAS (src/wb-models/pages/*.page.json) — JSON definitions for auto-generated showcase pages\n4. SITE SCHEMAS (src/wb-models/pages/*.site.json) — Multi-page collection definitions"
}
