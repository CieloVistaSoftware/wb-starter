{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "page-builder.schema.json",
  "title": "Page Builder",
  "description": "Schema for WB Page Builder multi-page website creation system",
  "behavior": "page-builder",
  "version": "2.1.0",
  "baseClass": "wb-page-builder",
  
  "definitions": {
    "Page": {
      "type": "object",
      "description": "A single page in the site",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique page identifier (e.g., 'home', 'about', 'contact')"
        },
        "name": {
          "type": "string",
          "description": "Display name shown in UI"
        },
        "slug": {
          "type": "string",
          "description": "URL filename (e.g., 'about.html', 'contact.html')"
        },
        "icon": {
          "type": "string",
          "description": "Emoji icon for page",
          "default": "üìÑ"
        },
        "seoTitle": {
          "type": "string",
          "description": "Browser tab / search engine title"
        },
        "seoDescription": {
          "type": "string",
          "description": "Meta description for SEO"
        },
        "main": {
          "type": "array",
          "description": "Page-specific components (not shared)",
          "items": { "$ref": "#/definitions/Component" }
        }
      },
      "required": ["id", "name", "slug"]
    },
    
    "Component": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique component ID (auto-generated, e.g., 'hero-1', 'card-2')"
        },
        "type": {
          "type": "string",
          "description": "Component type (e.g., 'hero', 'cta', 'wb-card')"
        },
        "data": {
          "type": "object",
          "description": "Component-specific configuration"
        },
        "nestedComponents": {
          "type": "array",
          "description": "Child components nested inside this component",
          "items": { "$ref": "#/definitions/NestedComponent" }
        }
      },
      "required": ["id", "type"]
    },
    
    "NestedComponent": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique nested component ID"
        },
        "type": {
          "type": "string",
          "description": "WB component type (e.g., 'wb-card', 'wb-alert')"
        },
        "config": {
          "type": "object",
          "description": "Component configuration"
        }
      },
      "required": ["id", "type"]
    },
    
    "SiteSettings": {
      "type": "object",
      "properties": {
        "siteName": {
          "type": "string",
          "description": "Website name"
        },
        "siteJsonPath": {
          "type": "string",
          "description": "Path to site.json configuration file",
          "default": "config/site.json"
        },
        "autoLoadSiteJson": {
          "type": "boolean",
          "description": "Auto-load site.json on startup",
          "default": true
        },
        "defaultTheme": {
          "type": "string",
          "enum": ["light", "dark", "auto"],
          "default": "light"
        },
        "confirmDelete": {
          "type": "boolean",
          "default": true
        },
        "showTooltips": {
          "type": "boolean",
          "default": true
        },
        "autoSave": {
          "type": "boolean",
          "default": true
        },
        "autoSaveInterval": {
          "type": "integer",
          "description": "Minutes between auto-saves",
          "default": 5
        }
      }
    },
    
    "ColorPicker": {
      "type": "object",
      "description": "Full color picker component (NEVER use native input[type=color])",
      "properties": {
        "value": {
          "type": "string",
          "pattern": "^#[0-9A-Fa-f]{6}$",
          "description": "Hex color value"
        },
        "presets": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Preset color palette"
        },
        "recentColors": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Recently used colors",
          "maxItems": 8
        },
        "showAlpha": {
          "type": "boolean",
          "description": "Show alpha channel slider",
          "default": false
        }
      }
    },
    
    "PhoneInput": {
      "type": "object",
      "description": "Phone number input with mask formatting",
      "properties": {
        "value": {
          "type": "string",
          "description": "Raw phone number (digits only)"
        },
        "displayValue": {
          "type": "string",
          "description": "Formatted display value"
        },
        "format": {
          "type": "string",
          "enum": ["us", "international"],
          "default": "us",
          "description": "Phone format style"
        },
        "placeholder": {
          "type": "string",
          "default": "(___) ___-____"
        }
      }
    },
    
    "Breadcrumb": {
      "type": "object",
      "description": "Navigation breadcrumb for properties panel",
      "properties": {
        "items": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "icon": { "type": "string" },
              "label": { "type": "string" },
              "onClick": { "type": "string", "description": "Function name to call" },
              "current": { "type": "boolean", "default": false }
            }
          }
        }
      }
    }
  },
  
  "properties": {
    "pages": {
      "type": "array",
      "items": { "$ref": "#/definitions/Page" },
      "description": "All pages in the site"
    },
    "globalSections": {
      "type": "object",
      "properties": {
        "header": {
          "type": "array",
          "items": { "$ref": "#/definitions/Component" },
          "description": "Shared header components"
        },
        "footer": {
          "type": "array",
          "items": { "$ref": "#/definitions/Component" },
          "description": "Shared footer components"
        }
      }
    },
    "currentPageId": {
      "type": "string",
      "description": "Currently active page ID"
    },
    "settings": { "type": "object", "$ref": "#/definitions/SiteSettings" }
  },
  
  "rules": {
    "CORE-001": {
      "id": "REUSE_WB_COMPONENTS",
      "rule": "ALWAYS use wb-* components instead of native HTML inputs",
      "applies": ["color inputs", "phone inputs", "all form fields"],
      "violation": "Using <input type='color'> instead of wb-colorpicker"
    },
    "CORE-002": {
      "id": "BREADCRUMB_NAVIGATION",
      "rule": "Properties panel MUST show breadcrumb path",
      "format": "üìÅ Site / üìÑ {page.slug} / üß© {section} / {icon} {component}",
      "example": "üìÅ Site / üìÑ contact.html / üß© Main / ü¶∏ Hero Section"
    },
    "CORE-003": {
      "id": "VISUAL_FEEDBACK",
      "rule": "All interactions provide immediate visual feedback",
      "triggers": {
        "editProperties": { "animation": "propsFlash", "color": "#10b981", "duration": "600ms" },
        "error": { "animation": "propsFlash", "color": "#ef4444", "duration": "600ms" },
        "save": { "animation": "propsFlash", "color": "#10b981", "duration": "600ms" },
        "select": { "animation": "pulse", "color": "#6366f1", "duration": "300ms" }
      }
    },
    "CORE-004": {
      "id": "SEARCHABLE_COMPONENT_BROWSER",
      "rule": "Container components show searchable component browser with 20+ components",
      "menuWidth": "320px",
      "maxHeight": "350px",
      "features": ["search input", "category headers", "sticky headers", "component icons"]
    },
    "CORE-005": {
      "id": "SITE_JSON_INTEGRATION",
      "rule": "Settings MUST include site.json path and auto-load capability",
      "settingsFields": ["siteJsonPath", "autoLoadSiteJson", "loadSiteJsonNow"]
    },
    "COLOR-001": {
      "id": "FULL_COLOR_PICKER",
      "rule": "All color inputs use full WB colorpicker component",
      "features": ["48x48px swatch", "hex input", "preset palette", "recent colors"],
      "applies": ["gradientStart", "gradientEnd", "backgroundColor", "textColor"]
    },
    "PHONE-001": {
      "id": "PHONE_MASK_INPUT",
      "rule": "Phone inputs use input masking for consistent formatting",
      "formats": {
        "us": "(###) ###-####",
        "international": "+## ### ### ####",
        "extension": "(###) ###-#### x####"
      }
    },
    "BREADCRUMB-001": {
      "id": "BREADCRUMB_REQUIRED",
      "rule": "Every properties panel MUST display breadcrumb showing navigation path",
      "clickable": ["Site", "Page", "Section", "Component"],
      "currentItem": "non-clickable, bold text"
    },
    "FEEDBACK-001": {
      "id": "EDIT_PROPERTIES_FLASH",
      "rule": "Right-click 'Edit Properties' MUST flash green border on properties panel",
      "animation": "propsFlash",
      "keyframes": {
        "0%": "box-shadow: inset 0 0 0 3px #10b981",
        "50%": "box-shadow: inset 0 0 0 3px #10b981, 0 0 20px rgba(16, 185, 129, 0.3)",
        "100%": "box-shadow: none"
      },
      "duration": "600ms"
    },
    "CONTAINER-001": {
      "id": "CONTAINER_COMPONENT_BROWSER",
      "rule": "Container components show categorized searchable component browser",
      "categories": ["Layout", "Cards", "Content", "Interactive", "Feedback"],
      "minComponents": 20
    },
    "SETTINGS-001": {
      "id": "SETTINGS_SITE_JSON",
      "rule": "Settings panel MUST include site.json configuration",
      "fields": [
        { "id": "siteJsonPath", "type": "text", "label": "site.json Path" },
        { "id": "autoLoadSiteJson", "type": "toggle", "label": "Auto-load site.json" },
        { "id": "loadNow", "type": "button", "label": "Load Config" }
      ]
    }
  },
  
  "componentCategories": {
    "layout": {
      "icon": "üìê",
      "label": "Layout",
      "items": [
        { "id": "wb-stack", "icon": "üìö", "name": "Stack" },
        { "id": "wb-cluster", "icon": "üî∑", "name": "Cluster" },
        { "id": "wb-grid", "icon": "üî≤", "name": "Grid" },
        { "id": "wb-container", "icon": "üì¶", "name": "Container" },
        { "id": "wb-sidebar", "icon": "üìë", "name": "Sidebar" },
        { "id": "wb-center", "icon": "üéØ", "name": "Center" },
        { "id": "wb-cover", "icon": "üìã", "name": "Cover" },
        { "id": "wb-switcher", "icon": "üîÄ", "name": "Switcher" },
        { "id": "wb-reel", "icon": "üéûÔ∏è", "name": "Reel" },
        { "id": "wb-frame", "icon": "üñºÔ∏è", "name": "Frame" }
      ]
    },
    "cards": {
      "icon": "üé¥",
      "label": "Cards",
      "items": [
        { "id": "wb-card", "icon": "üÉè", "name": "Card" },
        { "id": "wb-cardimage", "icon": "üñºÔ∏è", "name": "Image Card" },
        { "id": "wb-cardvideo", "icon": "üé¨", "name": "Video Card" },
        { "id": "wb-cardprofile", "icon": "üë§", "name": "Profile Card" },
        { "id": "wb-cardpricing", "icon": "üí∞", "name": "Pricing Card" },
        { "id": "wb-cardproduct", "icon": "üõçÔ∏è", "name": "Product Card" },
        { "id": "wb-cardstats", "icon": "üìä", "name": "Stats Card" },
        { "id": "wb-cardtestimonial", "icon": "üí¨", "name": "Testimonial" },
        { "id": "wb-cardhero", "icon": "ü¶∏", "name": "Hero Card" },
        { "id": "wb-cardfile", "icon": "üìÅ", "name": "File Card" },
        { "id": "wb-cardnotification", "icon": "üîî", "name": "Notification" },
        { "id": "wb-cardportfolio", "icon": "üíº", "name": "Portfolio" },
        { "id": "wb-cardlink", "icon": "üîó", "name": "Link Card" },
        { "id": "wb-cardhorizontal", "icon": "‚ÜîÔ∏è", "name": "Horizontal" },
        { "id": "wb-cardoverlay", "icon": "üé≠", "name": "Overlay" },
        { "id": "wb-cardbutton", "icon": "üîò", "name": "Button Card" },
        { "id": "wb-cardexpandable", "icon": "üìñ", "name": "Expandable" },
        { "id": "wb-cardminimizable", "icon": "‚ûñ", "name": "Minimizable" },
        { "id": "wb-carddraggable", "icon": "‚úã", "name": "Draggable" }
      ]
    },
    "content": {
      "icon": "üìù",
      "label": "Content",
      "items": [
        { "id": "wb-hero", "icon": "ü¶∏", "name": "Hero" },
        { "id": "wb-header", "icon": "üîù", "name": "Header" },
        { "id": "wb-footer", "icon": "üîª", "name": "Footer" },
        { "id": "wb-mdhtml", "icon": "üìÑ", "name": "Markdown" }
      ]
    },
    "interactive": {
      "icon": "üéÆ",
      "label": "Interactive",
      "items": [
        { "id": "wb-tabs", "icon": "üìë", "name": "Tabs" },
        { "id": "wb-collapse", "icon": "üìÇ", "name": "Collapse" },
        { "id": "wb-dropdown", "icon": "üîΩ", "name": "Dropdown" },
        { "id": "wb-drawer", "icon": "üì•", "name": "Drawer" }
      ]
    },
    "feedback": {
      "icon": "üí¨",
      "label": "Feedback",
      "items": [
        { "id": "wb-alert", "icon": "‚ö†Ô∏è", "name": "Alert" },
        { "id": "wb-badge", "icon": "üè∑Ô∏è", "name": "Badge" },
        { "id": "wb-progress", "icon": "üìä", "name": "Progress" },
        { "id": "wb-spinner", "icon": "üîÑ", "name": "Spinner" },
        { "id": "wb-rating", "icon": "‚≠ê", "name": "Rating" }
      ]
    }
  },
  
  "colorPresets": {
    "primary": ["#667eea", "#764ba2", "#6366f1", "#8b5cf6"],
    "success": ["#10b981", "#059669", "#22c55e", "#16a34a"],
    "warning": ["#f59e0b", "#d97706", "#eab308", "#ca8a04"],
    "danger": ["#ef4444", "#dc2626", "#f87171", "#b91c1c"],
    "info": ["#06b6d4", "#0891b2", "#22d3ee", "#0e7490"],
    "neutral": ["#1f2937", "#374151", "#6b7280", "#9ca3af"]
  },
  
  "compliance": {
    "baseClass": "wb-page-builder",
    "supportLevel": "stable",
    "accessibility": "high"
  },
  
  "test": {
    "setup": [
      "<wb-page-builder>Basic page builder</wb-page-builder>"
    ],
    "functional": {
      "rules": [
        {
          "name": "CORE-001: Reuse WB Components",
          "type": "audit",
          "check": "No native <input type='color'> in properties panel",
          "selector": "#propertiesPanel input[type='color']:not(.color-swatch input)",
          "expect": { "count": 0 }
        },
        {
          "name": "CORE-002: Breadcrumb Navigation",
          "type": "interaction",
          "steps": [
            "Select component on Contact page",
            "Check properties panel header"
          ],
          "expect": {
            "breadcrumb": "üìÅ Site / üìÑ contact.html / üß© Main / {icon} {component}"
          }
        },
        {
          "name": "CORE-003: Visual Feedback - Edit Properties Flash",
          "type": "interaction",
          "steps": [
            "Right-click component",
            "Click 'Edit Properties'"
          ],
          "expect": {
            "animation": "propsFlash",
            "duration": "600ms",
            "color": "#10b981"
          }
        },
        {
          "name": "CORE-004: Searchable Component Browser",
          "type": "interaction",
          "steps": [
            "Right-click wb-stack container",
            "Click 'Insert WB Component'"
          ],
          "expect": {
            "menuWidth": "320px",
            "hasSearch": true,
            "categories": 5,
            "componentCount": { "min": 20 }
          }
        },
        {
          "name": "CORE-005: Settings includes site.json",
          "type": "audit",
          "check": "Settings panel has site.json fields",
          "expect": {
            "fields": ["siteJsonPath", "autoLoadSiteJson"]
          }
        },
        {
          "name": "COLOR-001: Full Color Picker",
          "type": "interaction",
          "steps": [
            "Select Hero component",
            "Find gradientStart field"
          ],
          "expect": {
            "hasElement": ".wb-color-picker",
            "swatchSize": "48x48",
            "hasHexInput": true,
            "hasPresets": true
          }
        },
        {
          "name": "PHONE-001: Phone Mask Input",
          "type": "interaction",
          "steps": [
            "Select CTA component",
            "Set contact type to Phone",
            "Type '5551234567'"
          ],
          "expect": {
            "displayValue": "(555) 123-4567",
            "storedValue": "5551234567"
          }
        },
        {
          "name": "BREADCRUMB-001: Clickable Navigation",
          "type": "interaction",
          "steps": [
            "Select nested component",
            "Click page name in breadcrumb"
          ],
          "expect": {
            "navigation": "Shows page properties",
            "breadcrumbUpdates": true
          }
        },
        {
          "name": "CONTAINER-001: Component Browser Categories",
          "type": "audit",
          "check": "Container context menu has all categories",
          "expect": {
            "categories": ["Layout", "Cards", "Content", "Interactive", "Feedback"],
            "searchable": true,
            "stickyHeaders": true
          }
        },
        {
          "name": "SETTINGS-001: Site JSON Integration",
          "type": "interaction",
          "steps": [
            "Open Settings panel",
            "Find site.json section"
          ],
          "expect": {
            "hasPath": true,
            "hasToggle": true,
            "hasLoadButton": true
          }
        }
      ],
      "pages": [
        {
          "name": "Create page with template",
          "steps": [
            "Click 'Add Page'",
            "Select 'Contact' template",
            "Click 'Create Page'"
          ],
          "expect": {
            "pageExists": "contact",
            "hasComponents": ["hero", "cta"],
            "breadcrumb": "üìÅ Site / üìÑ contact.html"
          }
        },
        {
          "name": "Page breadcrumb shows slug",
          "steps": [
            "Navigate to Contact page",
            "Select Hero component"
          ],
          "expect": {
            "breadcrumb": "üìÅ Site / üìÑ contact.html / üß© Main / ü¶∏ Hero Section"
          }
        },
        {
          "name": "Switch pages via breadcrumb",
          "steps": [
            "On Contact page, click Site in breadcrumb",
            "Verify site settings shown"
          ],
          "expect": {
            "showsSiteSettings": true
          }
        }
      ],
      "colorPicker": [
        {
          "name": "Color swatch updates on hex input",
          "steps": [
            "Select Hero component",
            "Type '#ff0000' in hex input"
          ],
          "expect": {
            "swatchColor": "#ff0000",
            "previewUpdates": true
          }
        },
        {
          "name": "Preset color selection",
          "steps": [
            "Click preset color button"
          ],
          "expect": {
            "swatchUpdates": true,
            "hexInputUpdates": true,
            "componentUpdates": true
          }
        }
      ],
      "phoneMask": [
        {
          "name": "Format as typed",
          "input": "555",
          "expect": { "display": "(555" }
        },
        {
          "name": "Format 6 digits",
          "input": "555123",
          "expect": { "display": "(555) 123" }
        },
        {
          "name": "Format complete",
          "input": "5551234567",
          "expect": { "display": "(555) 123-4567" }
        },
        {
          "name": "Strip non-digits",
          "input": "(555) 123-4567",
          "expect": { "stored": "5551234567" }
        }
      ],
      "visualFeedback": [
        {
          "name": "Props panel flash on Edit Properties",
          "trigger": "context-menu:edit-properties",
          "expect": {
            "class": "props-flash",
            "duration": "600ms"
          }
        },
        {
          "name": "Error flash on validation failure",
          "trigger": "validation:error",
          "expect": {
            "class": "props-flash-error",
            "color": "#ef4444"
          }
        }
      ]
    }
  },
  
  "_metadata": {
    "category": "builder",
    "icon": "üèóÔ∏è",
    "since": "2.0.0",
    "status": "stable",
    "documentation": "docs/builder/pages.md"
  },

  "$view": [
    {
      "name": "container",
      "tag": "div",
      "class": "wb-page-builder"
    }
  ],

  "$methods": {
    "createPage": "Creates a new page",
    "deletePage": "Deletes a page by ID",
    "loadSiteJson": "Loads site configuration from JSON",
    "savePage": "Saves current page state"
  },

  "$cssAPI": {
    "--wb-page-builder-gap": "Gap between builder sections"
  }
}
