# Project Architecture<br>(AI-Friendly)

## Overview
This project is a modern, config-driven website starter kit built with the Web Behaviors (WB) library (Release 2.0). It includes a visual page builder and is designed for rapid development, high customizability, and zero build steps. The architecture is modular, declarative, and AI-friendly.

---

## 1. Folder Structure

- **public/**: Entry points (`index.html`, `builder.html`).
- **config/**: Contains `site.json` for all site configuration (navigation, branding, layout, SEO, etc).
- **pages/**: Static HTML content pages (home, features, components, docs, about, contact, etc).
- **assets/**: Images and other static assets.
- **styles/**: CSS for base, themes, and site-specific styles.
- **src/**: All JavaScript source code.
  - **core/**: Core engine (`wb.js`, `events.js`, `theme.js`, `config.js`).
  - **behaviors/**: Behavior modules (`index.js`, `js/`, `schema/`).
  - **builder/**: Visual builder logic (`builder.js`, `builder-tree.js`, etc.).
- **server/**: Simple Express server for development (`server.js`).
- **docs/**: Project documentation.

---

## 2. Core Concepts

- **Schema-First Architecture**: The project follows a "Schema-First" strategy where HTML Templates (via `wb-parts`) serve as the single source of truth for component structure. JavaScript behaviors act as "Progressive Enhancers" that hydrate this structure rather than building it.
- **Config-Driven**: The site is built dynamically from `config/site.json`. Navigation, theme, branding, and layout are all controlled via JSON.
- **No Build Step**: All code runs natively in the browser using ES Modules. No bundlers or transpilers required.
- **Auto Injection & Enhancement**: Behaviors are automatically attached to standard HTML5 semantic elements (e.g., `<article>` â†’ Card) or Custom Elements generated by templates. This enforces semantic correctness and reduces markup noise.
- **Modular Behaviors**: 230+ behaviors are available, organized by UI, form, animation, layout, and utility. Each is a pure function, not a class or web component.
- **Visual Builder**: A drag-and-drop interface (`builder.html`) allows users to construct pages visually, which are then saved as JSON or exported as HTML.

---

## 3. Main Components

- **WB Core (`src/core/wb.js`)**: Core engine for behavior injection, cleanup, and event logging. Exposes `WB.init()` to scan and enhance the DOM.
- **WB Parts (`src/core/wb-parts.js`)**: The Template Factory system. It reads `<template wb-part="...">` definitions and automatically registers them as Custom Elements.
- **Behaviors Registry (`src/behaviors/index.js`)**: Imports and registers all available behaviors. Behaviors are lazy-loaded from `src/behaviors/js/`.
- **Site Engine (`src/core/site-engine.js`)**: Loads config, builds navigation, header, and main content dynamically. Handles routing via URL hash.
- **Theme Manager (`src/core/theme.js`)**: Manages current theme, persists user preference, and updates the DOM.
- **Code Theme Manager (`src/behaviors/js/codecontrol.js`)**: A wrapper for highlight.js that manages syntax highlighting themes, providing a UI for selection and persisting user preference via `localStorage`.
- **Error Logger (`src/core/error-logger.js`)**: Captures runtime errors, logs them to `data/errors.json`, and displays a toast.
- **Builder Engine (`src/builder/`)**:
  - `index.js`: Entry point for the builder.
  - `builder.js`: Main builder logic (drag-and-drop, canvas management).
  - `builder-tree.js`: Manages the component tree view.
  - `builder-properties.js`: Handles the property editor panel.

---

## 4. Data Flow

### Site Runtime
1. **Startup**: `index.html` loads, imports `src/core/wb.js` and initializes the site engine.
2. **Config Load**: Site engine fetches `config/site.json` and applies settings.
3. **Page Render**: Navigation, header, and main content are rendered based on config and current URL hash.
4. **Auto Injection**: `WB.init()` scans the DOM for semantic elements (e.g., `article`, `nav`, `dialog`) and automatically injects the corresponding behaviors. Explicit attributes are additive. Use `data-wb-ignore` to opt-out.
5. **Error Handling**: Global handlers catch exceptions and log them to `data/errors.json` via `/api/save`.

### Builder Runtime
1. **Startup**: `public/builder.html` loads `src/builder/index.js`.
2. **Initialization**: Builder initializes the canvas, sidebar, and property panels.
3. **Interaction**: User drags components from sidebar to canvas.
4. **State Management**: Builder maintains a JSON representation of the page structure.
5. **Export**: User can export the design as HTML or JSON.

### Observability
- **Error Viewer**: `public/errors-viewer.html` provides a dashboard to view and clear logged errors.
- **Compliance Tests**: `tests/compliance/` ensures structural rules (IDs, scrollbars) are met.

---

## 5. AI-Friendly Features

- **Declarative Structure**: All UI and navigation are described in JSON and HTML, making it easy for AI to parse and modify.
- **Separation of Concerns**: Content, config, styles, and logic are cleanly separated.
- **Extensible**: New pages, behaviors, and themes can be added with minimal changes.
- **Self-Documenting**: Code and config are heavily commented and use descriptive names.
- **No Build Artifacts**: All source is human- and AI-readable, with no minification or obfuscation.

---

## 6. Technologies Used

- HTML5, CSS3 (with CSS variables and themes)
- JavaScript (ES6 modules)
- WB Behaviors (custom library)
- Express (for local development server)
- No frameworks, no build tools

---

## 7. Extending the Project

- **Add Behaviors**: Create new behavior files in `src/behaviors/js/` and register them in `src/behaviors/index.js`.
- **Add Pages**: Create HTML files in `pages/` and update `config/site.json`.
- **Add Themes**: Add new themes in `styles/themes.css` and register in `src/behaviors/js/themecontrol.js`.
- **Extend Builder**: Modify files in `src/builder/` to add new builder features or component definitions.

---

## 8. Behavior Schemas and Testing

**See: `docs/test-schema-standard.md` for complete specification**

### Core Principles
- **ONE test per component validates EVERYTHING** - params, buttons, elements, events, accessibility
- Each behavior has a JSON schema in `src/behaviors/schema/` with comprehensive test definitions
- Playwright integration tests use `index.html` as entry point with dynamic DOM injection

### Schema Sections (ALL REQUIRED)

| Section | Purpose |
|---------|----------|
| `properties` | All props with `permutations` and `assertions` |
| `compliance` | Required children, optional children, styles |
| `interactions` | ALL clickable/interactive elements with expected behavior |
| `accessibility` | ARIA attributes, roles, keyboard support |
| `events` | All custom events the component dispatches |
| `test.matrix` | Parameter combinations that must initialize |
| `test.functional` | Button clicks, hover, keyboard, API method tests |

### Test Tiers

1. **TIER 1: Base Compliance** - Has required class, creates required children
2. **TIER 2: Permutation Compliance** - All property values work correctly
3. **TIER 3: Style Compliance** - Required styles are applied
4. **TIER 4: Functional Compliance** - Buttons click, events fire, interactions work

### Key Rules
- Schemas, tests, and implementation code must always remain in sync
- Every button/interactive element must be tested for clickability
- Every custom event must be verified
- Keyboard accessibility must be tested
- Component cleanup/destroy must work without errors

---

## 9. Example: Adding a New Page

1. Create `pages/mypage.html` with your content.
2. Add a nav entry in `config/site.json`:
`json
{ "id": "mypage", "label": "My Page", "icon": "ðŸ“„", "page": "mypage" }
`
3. Refresh the browser. The new page appears in navigation.

---

## 10. Example: Using a Behavior

```html
<!-- Auto-injected Card Behavior -->
<article>
  <header><h3>Title</h3></header>
  <main>Content</main>
</article>

<!-- Explicit Shorthand (Decoration) -->
<button x-ripple>Click Me</button>

<!-- Explicit Shorthand (Morphing) -->
<article x-as-card>
  <header><h3>Title</h3></header>
  <main>Content</main>
</article>

<!-- Auto-injected Navigation Behavior -->
<nav>
  <ul>...</ul>
</nav>

<!-- Auto-injected Modal Behavior -->
<dialog>
  <header><h2>Title</h2></header>
  <main>Content</main>
</dialog>
```

---

## 11. Behavior Registration Rule

- All new behaviors must be both implemented and registered in `src/behaviors/index.js` before writing or running any tests for them.

---

## 12. License
MIT. Use freely in personal and commercial projects.
