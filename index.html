<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WB Starter</title>
  <meta name="description" content="WB Behaviors - A config-driven web component library">
  
  <!-- Layer 1: Foundation (OOP - only 2 files needed) -->
  <link rel="preload" href="src/styles/themes.css" as="style">
  <link rel="preload" href="src/styles/site.css" as="style">
  <link rel="stylesheet" href="src/styles/themes.css">
  <link rel="stylesheet" href="src/styles/site.css">
  <link rel="modulepreload" href="src/core/wb.js">
  <link rel="modulepreload" href="src/core/site-engine.js">
  <link rel="preload" href="config/site.json" as="fetch" crossorigin>
  
  <!-- Page Transitions CSS -->
  <link rel="stylesheet" href="src/styles/transitions.css">
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  
  <!-- PWA Support -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#6366f1">
</head>
<body>
  <!-- 
    ARCHITECTURAL NOTE:
    You won't see the standard HTML structure here. This project uses a 
    "Schema-First" architecture where the UI is generated dynamically.
    
    - src/core/site-engine.js: Builds the shell (Header, Nav, Footer)
    - config/site.json: Defines the structure and content
    - pages/*.html: Contains the actual page content loaded via fetch()
    
    This separation allows for deterministic AI generation and self-healing capabilities.

    HOW TO EDIT THE UI:
    1. To change the Layout (Header, Sidebar, Footer):
       - Edit `src/core/site-engine.js` (The render methods generate the HTML strings)
       - Edit `src/styles/site.css` (The styles for the shell)

    2. To change the Content (Pages):
       - Look in `pages/` folder. Each file corresponds to a route (e.g., ?page=home -> pages/home.html)

    3. To change the Configuration (Menu items, Site Name, Theme):
       - Edit `config/site.json`
  -->
  <!-- Site container - built dynamically from config -->
  <div id="app" class="site">
    <div class="site__loading">
      <div data-wb="spinner" data-color="primary"></div>
      <p>Loading...</p>
    </div>
  </div>

  <!-- Fallback UI for config load failure -->
  <template id="error-template">
    <div class="site__error">
      <div class="error__icon">⚠️</div>
      <h1>Unable to Load Site</h1>
      <p>Could not load configuration. Please check your connection and try again.</p>
      <button onclick="location.reload()" class="error__retry" data-wb="ripple">
        Retry
      </button>
    </div>
  </template>

  <script type="module">
    console.log('Script starting...');
    
    try {
      console.log('Importing WB...');
      const { default: WB } = await import('./src/core/wb.js');
      console.log('WB imported:', WB);
      
      console.log('Importing WBSite...');
      const { default: WBSite } = await import('./src/core/site-engine.js');
      console.log('WBSite imported:', WBSite);
      
      // Expose WB globally
      window.WB = WB;
    
      // Boot the site with error handling
      const site = new WBSite();
      console.log('WBSite instance created');
      
      console.log('Calling site.init()...');
      await site.init();
      console.log('site.init() complete');
      
      console.log('Calling navigateTo...');
      await site.navigateTo(site.currentPage);
      console.log('Navigation complete');
      
      // Expose for debugging
      window.WBSite = site;
    } catch (error) {
      console.error('❌ Site initialization failed:', error);
      console.error('Stack:', error.stack);
      const app = document.getElementById('app');
      const template = document.getElementById('error-template');
      if (template) {
        app.innerHTML = template.innerHTML;
        // Also show the actual error
        const errorDiv = document.createElement('pre');
        errorDiv.style.cssText = 'margin: 1rem; padding: 1rem; background: #1e1e1e; color: #f87171; border-radius: 8px; overflow: auto; font-size: 12px;';
        errorDiv.textContent = error.stack || error.message || String(error);
        app.appendChild(errorDiv);
      }
    }
  </script>
</body>
</html>
